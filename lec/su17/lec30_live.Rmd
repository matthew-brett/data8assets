---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.1'
      jupytext_version: 1.2.4
  kernelspec:
    display_name: Python 3
    language: python
    name: python3
---

```{python}
from datascience import *
import numpy as np

import matplotlib.pyplot as plt
plt.style.use('fivethirtyeight')
# %matplotlib inline

from ipywidgets import interact, interactive, fixed, interact_manual
import ipywidgets as widgets
```

## Correlation

```{python}
hybrid = Table.read_table('http://inferentialthinking.com/notebooks/hybrid.csv')
hybrid.show(3)
```

```{python}
hybrid.scatter('acceleration', 'msrp')
```

```{python}
hybrid.scatter('mpg', 'msrp')
```

```{python}
suv = hybrid.where('class', 'SUV')
suv.scatter('mpg', 'msrp')
```

```{python}
suv.scatter('acceleration', 'msrp')
```

```{python}
mean = np.mean(suv.column('msrp'))
sd = np.std(suv.column('msrp'))
mean, sd
```

```{python}
def standard_units(nums):
    mean = np.mean(nums)
    sd = np.std(nums)
    return (nums - mean) / sd
standard_units(suv.column('msrp'))
```

```{python}
Table().with_columns(
    'MSRP', suv.column('msrp'),
    'MRSP (su)', standard_units(suv.column('msrp')),
).scatter(0, 1)
```

```{python}
np.count_nonzero(standard_units(suv.column('msrp')) > 0) / len(suv.column('msrp'))
```

```{python}
def standardize(t):
    """Return a table in which all columns of t are converted to standard units."""
    t_su = Table()
    for label in t.labels:
        t_su = t_su.with_column(label + ' (su)', standard_units(t.column(label)))
    return t_su

standardize(suv.select('mpg', 'msrp')).show(3)
```

```{python}
standardize(suv.select('mpg', 'msrp')).scatter(0, 1)
plt.xlim(-3, 3)
plt.ylim(-3, 3)
```

```{python}
standardize(suv.select('acceleration', 'msrp')).scatter(0, 1)
plt.xlim(-3, 3)
plt.ylim(-3, 3)
```

## Visualizing Correlations

```{python}
def r_scatter(r):
    "Generate a scatter plot with a correlation approximately r"
    plt.figure(figsize=(5,5))
    x = np.random.normal(0, 1, 1000)
    z = np.random.normal(0, 1, 1000)
    y = r*x + (np.sqrt(1-r**2))*z
    plt.scatter(x, y)
    plt.xlim(-4, 4)
    plt.ylim(-4, 4)
    plt.show()
```

```{python}
_ = interact(r_scatter, r=(-1, 1, 0.1))
```

## Calculating r

```{python}
x = np.arange(1, 7, 1)
y = make_array(2, 3, 1, 5, 2, 7)
t = Table().with_columns(
        'x', x,
        'y', y
    )
t
```

```{python}
t.scatter(0, 1)
```

```{python}
t_standard = standardize(t)
t_standard
```

```{python}
t_standard.column(0) * t_standard.column(1)
```

```{python}
t_standard.with_column(
    'product', t_standard.column(0) * t_standard.column(1),
)
```

```{python}
np.mean(t_standard.column(0) * t_standard.column(1))
```

```{python}
def correlation(t, x, y):
    return np.mean(standard_units(t.column(x))
                   * standard_units(t.column(y)))

correlation(t, 'x', 'y')
```

```{python}
suv.scatter('acceleration', 'msrp')
```

```{python}
correlation(suv, 'acceleration', 'msrp')
```

```{python}
suv.scatter('mpg', 'msrp')
```

```{python}
correlation(suv, 'mpg', 'msrp')
```

```{python}

```
