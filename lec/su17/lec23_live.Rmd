---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.1'
      jupytext_version: 1.2.4
  kernelspec:
    display_name: Python 3
    language: python
    name: python3
---

```{python}
from datascience import *
import numpy as np

import matplotlib.pyplot as plt
plt.style.use('fivethirtyeight')
# %matplotlib inline

from ipywidgets import interact, interactive, fixed, interact_manual
import ipywidgets as widgets
```

## Percentiles

```{python}
v = [1, 7, 3, 9, 5]
v
```

```{python}
Table().with_columns(
    'Percent', make_array(1, 10, 20, 39, 40, 41, 50),
    'Percentile', make_array(
        percentile(1, v), percentile(10, v),
        percentile(20, v), percentile(39, v),
        percentile(40, v), percentile(41, v),
        percentile(50, v)
    )
)
```

   1   3   5   7    9
  20  40  60  80   100


## Estimation

```{python}
sf = Table.read_table('http://inferentialthinking.com/notebooks/san_francisco_2015.csv').select(3, 11, 21)
sf.set_format(2, NumberFormatter(0))
sf = sf.where(2, are.above(10000))
sf.show(3)
```

```{python}
sf.sort(2)
```

```{python}
sf.sort(2, descending=True).show(3)
```

```{python}
comp_bins = np.arange(0, 700000, 25000)
sf.hist(2, bins=comp_bins, unit='dollar')
```

```{python}
sample_from_population = sf.sample(200, with_replacement=False)
sample_from_population.show(3)
```

```{python}
np.median(sample_from_population.column(2))
```

## Aside: lists and append

```{python}
a = make_array(2, 3, 4)
a
```

```{python}
np.append(a, 5)
```

```{python}
a
```

```{python}
b = [2, 3, 4]
b
```

```{python}
b.append(5)
```

```{python}
b
```

## Sample variability

```{python}
medians = []
repetitions = 100

for i in np.arange(repetitions):
    sample_from_population = sf.sample(200, with_replacement=False)
    medians.append(np.median(sample_from_population.column(2)))

Table().with_columns(
    'i', np.arange(100),
    'median', medians,
).scatter('i')
```

## Bootstrap

```{python}
sample_from_population.show(3)
```

```{python}
np.median(sample_from_population.column(2))
```

```{python}
resample = sample_from_population.sample()
resample.show(3)
```

```{python}
np.median(resample.column(2))
```

What is the difference between these two?

```{python}
resampled_medians = []

for i in np.arange(1000):
    resample = sample_from_population.sample()
    median = np.median(resample.column(2))
    resampled_medians.append(median)

Table().with_column(
    "Resampled median", resampled_medians
).hist(0)
```

```{python}
comp_bins = np.arange(0, 700000, 25000)
sf.hist(2, bins=comp_bins, unit='dollar')
```

## Confidence Intervals

```{python}
print("95% of resampled medians were between", 
      percentile(2.5, resampled_medians),
      "and",
      percentile(97.5, resampled_medians))
```

```{python}
Table().with_column('Resampled median', resampled_medians).hist(0)

# Draw the line and dot
interval_95 = [percentile(2.5, resampled_medians),
               percentile(97.5, resampled_medians)]
plt.plot(interval_95, [0, 0], color='gold', lw=5)
pop_median = np.median(sf.column(2))
plt.scatter(pop_median, 0, color='red', s=400)
```

```{python}
sample_from_population = sf.sample(200, with_replacement=False)
resample = sample_from_population.sample()

resampled_medians = []

for i in np.arange(1000):
    resample = sample_from_population.sample()
    median = np.median(resample.column(2))
    resampled_medians.append(median)

Table().with_column('Resampled median', resampled_medians).hist(0)

# Draw the line and dot
interval_95 = [percentile(2.5, resampled_medians),
               percentile(97.5, resampled_medians)]
plt.plot(interval_95, [0, 0], color='gold', lw=5)
pop_median = np.median(sf.column(2))
plt.scatter(pop_median, 0, color='red', s=400)
```

How often does the population median appear in my interval?

```{python}

```
