---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.1'
      jupytext_version: 1.2.4
  kernelspec:
    display_name: Python 3
    language: python
    name: python3
---

```{python}
import numpy as np
np.set_printoptions(threshold=50, linewidth=50)
```

## Tables

```{python}
from datascience import *
```

```{python}
Table(['Even', 'Odd'])
```

```{python}
Table(['Even', 'Odd']).with_row([2, 3])
```

```{python}
Table(['Even', 'Odd']).with_rows([[2, 3], [4, 5]])
```

```{python}
Table().with_column('Odd', np.arange(1, 5, 2))
```

```{python}
Table().with_columns([
        'Even', [2, 4],
        'Odd', [3, 5]
    ])
```

```{python}
url = 'http://www.census.gov/popest/data/national/asrh/2014/files/NC-EST2014-AGESEX-RES.csv'
full = Table.read_table(url)
full
```

```{python}
partial = full.select(['SEX', 'AGE', 4, 8])
partial
```

```{python}
simple = partial.relabeled('POPESTIMATE2010', '2010').relabeled(3, '2014')
simple
```

```{python}
simple.column('AGE')
```

```{python}
simple.column(1)
```

```{python}
simple.column(2).item(3)
```

#### Discussion question

```{python}
census = simple.with_columns([
        'Change', simple.column(3) - simple.column(2), 
        'Growth', (simple.column(3) / simple.column(2)) ** (1/4) - 1])
census
```

```{python}
census.labels
```

```{python}
census.num_rows
```

```{python}
census.num_columns
```

```{python}
census.set_format('Growth', PercentFormatter)
census.set_format([2, 3, 4], NumberFormatter)
```

```{python}
max(census.column('AGE'))
```

## Transformations

```{python}
totals = census.where('AGE', 999)
totals
```

```{python}
totals.take(0)
```

```{python}
totals.take([1, 2])
```

```{python}
sum(totals.take([1, 2]).column('2014'))
```

```{python}
census.column('AGE') < 999
```

```{python}
census.where(census.column('AGE') < 999)
```

```{python}
females = census.where('SEX', 2)
sum(females.where(females.column('AGE') < 999).column('2014'))
```

#### Discussion question

```{python}
females.where(females.column(3)/females.column(2) >= 1.03).num_rows
```

```{python}
females.where((females.column('Growth')+1)**4 >= 1.03).num_rows
```

```{python}
males = census.where('SEX', 1)
males.sort('Growth', descending=True)
```

```{python}
males.where(males.column('Change') > 300000).sort('AGE').show()
```

```{python}
males.where(np.logical_and(males.column('AGE') > 55, 
                           males.column('AGE') < 70)).show()
```

```{python}
females.where(np.logical_or(females.column('AGE') == 18,
                            females.column('AGE') == 19))
```

## Group

```{python}
no_sums = census.where(np.logical_and(census.column('AGE') < 999,
                                      census.column('SEX') > 0))
no_sums
```

```{python}
no_sums.group('SEX')
```

```{python}
no_sums.group('SEX', sum)
```

```{python}
no_sums.group('SEX', list)
```

```{python}
pivoted = no_sums.pivot('SEX', 'AGE', '2014', sum)
m_vs_f = pivoted.relabeled(1, 'Male').relabeled(2, 'Female')
m_vs_f.with_column('Diff', m_vs_f.column(2)-m_vs_f.column(1)).show()
```
