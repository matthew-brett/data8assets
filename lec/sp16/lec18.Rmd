---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.1'
      jupytext_version: 1.2.4
  kernelspec:
    display_name: Python 3
    language: python
    name: python3
---

```{python}
import numpy as np
from datascience import *

# Configure notebook (happens automatically on data8.berkeley.edu)
# %matplotlib inline
import matplotlib.pyplot as plt
plt.style.use('fivethirtyeight')

# Configure for presentation
np.set_printoptions(threshold=50, linewidth=50)
import matplotlib as mpl
mpl.rc('font', size=16)
```

```{python}
def standard_units(any_numbers):
    "Convert any array of numbers to standard units."
    return (any_numbers - np.mean(any_numbers))/np.std(any_numbers)  

def correlation(t, x, y):
    "Compute r."
    return np.mean(standard_units(t.column(x))*standard_units(t.column(y)))
```

```{python}
heights = Table.read_table('heights.csv')
fathers = heights.column('father')
sons = heights.column('son')
heights.scatter('father', 'son', s=10)
```

```{python}
r = correlation(heights, 'father', 'son')
r
```

```{python}
six_foot_fathers = heights.where(np.round(fathers) == 72)
six_foot_fathers.hist('son', bins=np.arange(55.5, 80, 1))
```

```{python}
sons_of_sff = np.mean(six_foot_fathers.column('son'))
sons_of_sff
```

```{python}
heights_su = Table().with_columns([
        'father (su)', standard_units(fathers),
        'son (su)', standard_units(sons)
    ])
heights_su.scatter('father (su)', s=10)
plt.plot([-3, 3], [-3 * r, 3 * r], color='g')
```

```{python}
six_foot_su = (72-np.average(fathers))/np.std(fathers)
six_foot_su
```

```{python}
(sons_of_sff - np.average(sons))/np.std(sons)
```

```{python}
rounded = heights_su.with_column('father (su)', np.round(father_su))
rounded.join('father (su)', rounded.group(0, np.average)).scatter(0, s=80)

import matplotlib.pyplot as plt
plt.plot([-3, 3], [-3 * r, 3 * r], color='g')
```

```{python}
heights_su.scatter('father (su)', s=10, fit_line=True)
# plt.plot([-3, 3], [-3 * r, 3 * r], color='b')
plt.plot([-3, 3], [-3, 3], color='r')
```

```{python}
(r * six_foot_su) * np.std(sons) + np.average(sons)
```

```{python}
heights_su.scatter('son (su)', s=10, fit_line=True)
```

## Discussion

```{python}
x = 90
x_su = (x-70)/10
y_su = 0.75 * x_su
y_su * 12 + 50
```

```{python}
x = 60
x_su = (x-70)/10
y_su = 0.75 * x_su
y_su * 12 + 50
```

```{python}
68-41
```

## Slope & Intercept

```{python}
def slope(table, x, y):
    r = correlation(table, x, y)
    return r * np.std(table.column(y))/np.std(table.column(x))

def intercept(table, x, y):
    a = slope(table, x, y)
    return np.mean(table.column(y)) - a * np.mean(table.column(x))

[slope(heights, 'father', 'son'), intercept(heights, 'father', 'son')]
```

```{python}
r
```

```{python}
def fit(table, x, y):
    """Return the height of the regression line at each x value."""
    a = slope(table, x, y)
    b = intercept(table, x, y)
    return a * table.column(x) + b

fitted = heights.with_column('son (fitted)', fit(heights, 'father', 'son'))
fitted
```

```{python}
fitted.scatter(0, s=10)
```

```{python}
rounded = heights.with_column('father', np.round(heights.column('father')))
rounded.join('father', rounded.group(0, np.average)).scatter(0, s=80, fit_line=True)
```
